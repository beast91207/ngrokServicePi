events {}

http {
    include       mime.types;
    default_type  application/octet-stream;

    server {
        listen 80;
        # server_name _;

        root /usr/share/nginx/html;

        # Serve static files
        location / {
            index index.html;
            try_files $uri $uri/ =404;
            # Optional: allow CORS for static files too
            add_header Access-Control-Allow-Origin * always;
        }

        # Serve HLS files with proper MIME types and full CORS
        location ~ \.(m3u8|ts)$ {

            # Optional: handle OPTIONS preflight for CORS
            if ($request_method = OPTIONS) {
                add_header Access-Control-Allow-Origin * always;
                add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
                add_header Access-Control-Allow-Headers * always;
                add_header Content-Length 0;
                add_header Content-Type text/plain;
                return 204;
            }

            add_header Access-Control-Allow-Origin * always;
            add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
            add_header Access-Control-Allow-Headers * always;

            types {
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }

            # Optional: caching for better HLS performance
            # Expires can be tuned depending on your workflow
            #expires 5s;
        }
    }
}
